{% extends '::layout.html.twig' %}

{% block title title %}

{% block content %}
	<h1 class="ui header">{{ block('title') }}</h1>

    <table class="ui compact table">
        <thead>
            <tr>
                <th style="padding: 0em .7em;">Titre</th>
                {{ knp_pagination_sortable(projects, "Date de dépôt", 'p.depositDate') }}
                {{ knp_pagination_sortable(projects, "Délais", 'p.delay') }}
                {{ knp_pagination_sortable(projects, "Statut", 'p.state') }}
                <th style="padding: 0em;">Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for project in projects %}
            <tr>
                <td><a href="{{ path('je_business_project_show', {id:project.id}) }}" class="item">{{ project.title }}</a></td>
                <td>{{ project.depositDate|format_date }}</td>
                <td>{{ project.delay|format_date }}</td>
                <td>
                    {% if project.state != 'state_aborted' and project.state != 'state_closed' and project.state != 'state_waiting_information' %}
                        {% if project.state == 'state_opened' %}
                            {{ 'state_opened'|projectState }}
                        {% endif %}
                        {% if project.commercial is null %}
                            {{ 'state_waiting_commercial'|projectState }}
                        {% endif %}
                        {% if project.students|length < 1 %}
                            {{ 'state_waiting_student'|projectState }}
                        {% endif %}
                    {% else %}
                        {{ project.state|projectState }}
                    {% endif %}
                </td>
                <td>
                    <div class="ui labeled icon top right pointing dropdown mini button">
                        <i class="settings icon"></i>
                        Actions
                        <div class="menu">
                            <a href="{{ path('je_business_project_show', {id:project.id}) }}" class="item">
                                <i class="unhide icon"></i> Afficher
                            </a>
                            {% if isGranted('ROLE_CHARGE') %}
                                <a href="{{ path('je_business_project_edit', {id:project.id}) }}" class="item">
                                    <i class="pencil icon"></i> Editer
                                </a>
                            {% endif %}
                            {% if project.scopeStatement is not null %}
                                <a href="{{ path('sonata_media_download', {'id': project.scopeStatement|sonata_urlsafeid }) }}" class="item">
                                    <i class="file icon"></i> Cahier des charges
                                </a>
                            {% endif %}
                            {% if project.graphicCharter is not null %}
                                <a href="{{ path('sonata_media_download', {'id': project.graphicCharter|sonata_urlsafeid }) }}" class="item">
                                    <i class="file icon"></i> Charte graphique
                                </a>
                            {% endif %}
                            {% if isGranted('ROLE_ADMIN') %}
                                <a href="{{ path('je_business_project_delete_confirmation', {id:project.id}) }}" class="item">
                                    <i class="delete icon"></i> Supprimer
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="6">
                    Aucun AP
                </td>
            </tr>
        {% endfor %}
        </tbody>
        <tfoot>
        <tr>
            <th colspan="6">
                <a class="ui green labeled icon button" href="{{ path('je_business_project_new') }}">
                    Nouveau <i class="plus icon"></i>
                </a>
                {{ knp_pagination_render(projects) }}
            </th>
        </tr>
        </tfoot>
    </table>

{% endblock %}
